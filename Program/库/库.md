<!--
 * @Description: 
 * @Version: 1.0
 * @Author: DaLao
 * @Email: dalao@xxx.com
 * @Date: 2022-08-15 23:02:04
 * @LastEditors: daLao
 * @LastEditTime: 2022-10-05 12:30:44
-->


## 库

库(Library)其实是一组目标文件的包.是将一些最常用的代码编译成目标文件后打包存放

- hello.h

```c++
#ifndef HELLO_H
#define HELLO_H

#include <stdio.h>

void hello();

#endif
```

- hello.c

```c
#include "hello.h"

void hello()
{
    printf("Hello World!\n");
}
```

- main.c

```c
#include "hello.h"

int main(void)
{
    hello();
    return 0;
}
```


#### 生成目标文件


`- c` 只激活预处理, 编译, 和汇编, 仅生成.o 目标文件

```c
gcc -c hello.c -o hello.o
```


### 静态库

- Linux下为`.o`/`.a`

- Windows下为`.obj` 和 `.lib`


#### 创建

将hello.o 生成静态库文件

```sh
# Linux环境
ar -crv libhello.a hello.o
```

- ar

- crv


#### 链接

```c
gcc -c main.c -o main.o

gcc main.o libhello.a -o main
```


#### 运行

```c
./main
```

删除静态库后对程序无影响

```c
sudo rm libhello.a

./main
```


### 动态库

- Linxu下为`.so`

- Windows下为`.dll`


#### 创建

```sh
# Linux环境
gcc -shared -fPIC -o libhello.so hello.o
```

- shared

此选项将尽量使用动态库.所以生成文件较小, 但需要系统动态库


- fPIC

fPIC(Position Independent Code), 用于生成位置无关代码


#### 链接

```c
gcc -c main.c -o main.o

gcc main.o libhello.so -o main
```


#### 运行

若报找不到库文件错误, 移动动态库到/usr/lib目录

```c
sudo mv libhello.so /usr/lib

./main
```
